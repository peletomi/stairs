<!DOCTYPE html>
<!--
Copyright (c) 2013, Tamas Eppel
All rights reserved.
-->
<html>
<head>
    <title>Stairs</title>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <style>
    body {
        font-family: verdana,sans-serif;
        font-size: 12px;
    }
    table {
        border: 2px;
        padding: 2px;
        margin: 2px;
    }
    table td {
        height: 30px;
    }
    table td.label {
        background-color: #b0e0e6;
    }
    </style>
    <script language="javascript1.5">
    var DIGIT_RE = /\d+(:?[,.]\d+)?/;

    function get_side_length(length, angle) {
        return (length * Math.tan(angle * Math.PI / 180)).toFixed(2) * 1;
    }

    function get_value(id) {
        return parseFloat(document.getElementById(id).value.replace(',', '.'));
    }

    function calculate() {
        var step_limit = get_value("step_limit");
        var stopper_length = get_value("stopper_length");
        var stair_height = get_value("stair_height");
        var step_length = get_value("step_length");
        var step_height = get_value("step_height");
        var angle = get_value("angle");

        if (!(DIGIT_RE.test(stair_height) && (DIGIT_RE.test(step_length) || DIGIT_RE.test(step_height)) && DIGIT_RE.test(angle))) {
            return;
        }

        if (DIGIT_RE.test(step_length)) {
           step_height = get_side_length(step_length, angle);
        } else {
           step_length = get_side_length(step_height, 90 - angle);
        }

        var step_count = 0;
        var stopper_count = 0;
        var current_height = 0.0;
        while (current_height < stair_height) {
            step_count++;
            current_height += step_height;
            if (step_count % step_limit == 0) {
                stopper_count++;
                current_height += step_height;
            }
        }
        var end_length = step_count * step_length + stopper_count + stopper_length;

        step_height = (stair_height / (step_count + stopper_count));
        var end_height = step_height * (step_count + stopper_count);
        var end_angle = Math.atan(step_height / step_length) * 180 / Math.PI;

        document.getElementById("step_height").value = step_height;
        document.getElementById("step_length").value = step_length;
        document.getElementById("step_count").innerHTML = step_count;
        document.getElementById("stopper_count").innerHTML = stopper_count;
        document.getElementById("end_height").innerHTML = end_height;
        document.getElementById("end_length").innerHTML = end_length;
        document.getElementById("end_angle").innerHTML = end_angle;
    }
    </script>
</head>
<body>
<div>
    <div style="float:left;">
    <table>
            <tr>
                <td class="label"><label for="stair_height">Treppen Höhe</label></td>
                <td><input id="stair_height" type="number" /></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label"><label for="angle">Winkel</label></td>
                <td><input id="angle" type="number" /></td>
                <td>°</td>
            </tr>
            <tr>
                <td class="label"><label for="step_length">Stufen Länge</label></td>
                <td><input id="step_length" type="number" /></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label"><label for="step_height">Stufen Höhe</label></td>
                <td><input id="step_height" type="number"/></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label">Stufen Anzahl</td>
                <td id="step_count"></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label">Podest Anzahl</td>
                <td id="stopper_count"></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label">End Höhe</td>
                <td id="end_height"></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label">End Länge</td>
                <td id="end_length"></td>
                <td>cm</td>
            </tr>
            <tr>
                <td class="label">End Winkel</td>
                <td id="end_angle"></td>
                <td>°</td>
            </tr>
    </table>
    </div>
    <div>
    <table>
        <tr>
            <td class="label"><label for="step_limit">Stufen Limit</label></td>
            <td><input id="step_limit" type="number" value="18"/></td>
            <td>nr.</td>
        </tr>
        <tr>
            <td class="label"><label for="stopper_length">Podest Länge</label></td>
            <td><input id="stopper_length" type="number" value="120.0"/></td>
            <td>cm</td>
        </tr>
        </table>
    </div>
</div>
<button onclick="calculate()">Berechnen</button>

</body>
</html>